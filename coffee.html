<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matt & Chai</title>

    <link href="./styles/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="./styles/style-coffee.css" rel="stylesheet" type="text/css" media="all">
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=electrical_services,wifi" /> 


    <script>
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.media = "all";

      const isNight = (!document.cookie || document.cookie.includes('night'))
      link.href = isNight ? "./styles/style-night.css" : "./styles/style-day.css";

      const coffeeStyles = document.createElement("link");
      coffeeStyles.rel = "stylesheet";
      coffeeStyles.type = "text/css";
      coffeeStyles.media = "all";

      coffeeStyles.href = isNight ? "./styles/style-coffee-night.css" : "./styles/style-coffee-day.css";


      document.head.appendChild(link);
      document.head.appendChild(coffeeStyles);
    </script>
  </head>
  <body>
  
    <script type="text/javascript" src="./header.js"></script>
    
    <site-header></site-header>
    <h1>Edmonton Coffee Spots</h1>
    <main>
      <div id="map"></div>
      <div id="shop-list">

      </div>
    </main>

    <script>


      var map = L.map('map').setView([53.5461, -113.4938], 11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);  

      fetch("./coffeeshops.json").then((res) => res.json()).then((res) => {
        // make sections for all letters of the alphabet
        for (let i = 65; i <= 90; i++) {
          const currentLetter = String.fromCharCode(i);
          const matchingShops = res.filter((shop) => shop["Coffee Shop Name"][0] == currentLetter);
          if (matchingShops.length > 0) {

            // create the section
            const section = document.createElement("section");
            section.className = 'letter-category';

            const header = document.createElement('h2');
            header.className = 'shop-list-letter-header';
            header.textContent = currentLetter;

            section.appendChild(header);

            const hr = document.createElement('hr');

            document.body.appendChild(section);
            document.body.appendChild(hr);


            matchingShops.forEach((shop) => {
              // add shop to shop list
              const section = document.getElementsByClassName("letter-category")
              const match = Array.from(section).find((el) => el.getElementsByClassName("shop-list-letter-header")[0].innerText === shop["Coffee Shop Name"][0]);
              match.innerHTML += `
                <div class="shop-list-item">
                  <h3 class="shop-name" id=${shop["Coffee Shop Name"]}>${shop["Coffee Shop Name"]}</h3>
                  <div class="shop-list-item-data">
                    <div class="shop-item-icons">
                    ${
                      shop["Wifi"] == "Yes" ? 
                      ` <span class="material-symbols-outlined">
                        wifi
                      </span>`
                      : ""
                      }
                    ${
                      shop['Power Outlet'] == "Yes" ?
                      `
                      <span class="material-symbols-outlined">
                        electrical_services
                      </span>
                      ` : ""
                    }
                    ${
                      shop["Would I come back?"].toLowerCase().includes("yes")
                      ? 
                      `
                        <span class="shop-heart-icon">
                          ♡
                        </span>
                      ` : ""
                    }
                    </div>


                    <div>
                      <div class="shop-quick-data">
                        <span>
                          ${shop["Address"]}
                        </span>
                        <span class="quick-data-separator">
                          ⬤
                        </span>
                        <span>
                          ${shop["Time Visited"]}
                        </span>
                      </div>
                      <div class="coffee-data-line-container">
                        <span class="coffee-data-line">
                          Vibe
                        </span>
                        <span class="coffee-data-line-content">
                          ${shop["Vibe"]}
                        </span>
                      </div>
                      <div class="coffee-data-line-container">
                        <span class="coffee-data-line">
                          What we ordered
                        </span>
                        <span class="coffee-data-line-content">
                          ${shop["What we ordered"]}
                        </span>
                      </div>
                      <div class="coffee-data-line-container">
                        <span class="coffee-data-line">
                          Seating
                        </span>
                        <span class="coffee-data-line-content">
                          ${shop["Seating"]}
                        </span>
                      </div>
                      <div class="coffee-data-line-container">
                        <span class="coffee-data-line">
                          Other comments
                        </span>
                        <span class="coffee-data-line-content">
                          ${shop["Comments"]}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <br>`;

              // add shop to map
              L.marker(shop["Coordinates"]).addTo(map)
                .bindPopup(`
                <div style="width:200px;">
                    <div style="display: flex;">
                    <a class="map-marker" href="#${shop["Coffee Shop Name"].split(" ")[0]}"><b style="font-weight:800; font-family: Arial Black;">${shop["Coffee Shop Name"]}</b></a>
                    <div class="marker-icons-container">
                      ${
                        shop["Wifi"] == "Yes" ? 
                        ` <span class="material-symbols-outlined">
                          wifi
                        </span>`
                        : ""
                        }
                      ${
                        shop['Power Outlet'] == "Yes" ?
                        `
                        <span class="material-symbols-outlined">
                          electrical_services
                        </span>
                        ` : ""
                      }
                      ${
                        shop["Would I come back?"].toLowerCase().includes("yes")
                        ? 
                        `
                          <span class="shop-heart-icon">
                            ♡
                          </span>
                        ` : ""
                      }
                      </div>
                  </div>
                  <div class="marker-address">
                    ${shop["Address"]}
                  </div>
                  <div>
                    ${shop["Vibe"]}
                  </div>
                </div>
                `);
            });


            }

          }
      })

    </script>
  </body>
</html>
